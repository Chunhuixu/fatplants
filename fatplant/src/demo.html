<!DOCTYPE>

<html>

<head>
  <title>cytoscape-cola.js demo</title>

  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
  <script src="js/jquery.js"></script>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

  <!-- for testing with local version of cytoscape.js -->
  <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

  <script src="https://unpkg.com/webcola/WebCola/cola.min.js"></script>
  <script src="js/cytoscape-cola.js"></script>
  <script src="https://unpkg.com/tippy.js@4.0.1/umd/index.all.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@4.0.1/index.css" />

  <script src="https://unpkg.com/popper.js@1.14.7/dist/umd/popper.js"></script>
  <script src="js/cytoscape-popper.js"></script>
  <script src="https://unpkg.com/popper.js@1"></script>
  <script src="https://unpkg.com/tippy.js@5"></script>
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@5/dist/backdrop.css" />

  <style>
    body {
      font-family: helvetica;
      font-size: 14px;
    }

    #cy {
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      z-index: 999;
    }

    h1 {
      opacity: 0.5;
      font-size: 1em;
    }
    .tippy-popper {
      transition: none !important;
    }
  </style>

  <script>
      document.addEventListener('DOMContentLoaded', function(){
          $.getJSON({url: "/data",success: function (data) {
                  console.log(data);
                  var elementsdata = data;
                  var cy = window.cy = cytoscape({
                      container: document.getElementById('cy'),

                      autounselectify: true,

                      boxSelectionEnabled: false,

                      layout: {
                          name: 'cola',
                          idealEdgeLength: 500,
                          nodeOverlap: 200,
                          refresh: 10,
                          fit: true,
                          padding: 30,
                          randomize: false,
                          componentSpacing: 100,
                          nodeRepulsion: 400000000,
                          edgeElasticity: 100,
                          nestingFactor: 5,
                          gravity: 80,
                          numIter: 1000,
                          initialTemp: 200,
                          coolingFactor: 0.95,
                          minTemp: 1.0,
                          maxSimulationTime: 3000,
                      },

                      style: [
                          {
                              selector: 'node',
                              css: {
                                  'background-color': 'black',
                                  'label': 'data(id)'
                              }
                          },

                          {
                              selector: 'edge',
                              css: {
                                  'line-color': 'gray'
                              }
                          }
                      ],

                      elements: elementsdata,
                      pixelRatio: 1,
                      hideEdgesOnViewport: true,
                      textureOnViewport: true,

                  });

                  var nodeDescriptionData = null;
                  // get node description info
                  $.get({
                      url: '/node-description',
                      success: function (data) {
                          nodeDescriptionData = data;
                      }
                  });
                  cy.on('mouseover', 'node', function(event){

                      var node = event.target;
                      nodeData = node.data();

                      for( var j=0;j<nodeDescriptionData.length;j++){
                          if(nodeData['id'] == nodeDescriptionData[j]['node']){
                              tmp = cy.getElementById(nodeData['id']);
                              console.log(tmp);
                              // let ref = cy.popperRef({
                              //     renderedPosition: () => ({ x: node.position()[0], y: node.position[1] })
                              // });
                              // console.log(node);
                              // console.log(ref);
                              var tippyA = tippy('#myButton', {
                                  content: nodeDescriptionData[j]['annotation'].split(' ').map((s) => s.charAt(0).toUpperCase() + s.substring(1)).join(' '),
                                  interactive: true,
                                  animation: 'perspective',
                                  trigger: 'click',
                                  placement:'bottom'
                              });
                              // console.log(tippyA);
                              tippyA[0].show();
                              console.log(nodeDescriptionData[j]['annotation'].split(' ').map((s) => s.charAt(0).toUpperCase() + s.substring(1)).join(' '));
                              break;
                          }
                      }

                  });

                  cy.on('mouseout', 'node', function(event){

                      $('.tippy-popper').remove();

                  });


              }});

      });
  </script>
</head>

<body>
<button id="myButton">My Button</button>
<div id="cy"></div>

</body>

</html>
